<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>El Impostor - Jugador</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="container">
    <h1>🎭 El Impostor</h1>
    <p class="text-center mb-20">Únete al juego y descubre si eres el impostor</p>

    <form id="joinForm">
      <div class="form-group">
        <label for="name">Tu nombre:</label>
        <input type="text" id="name" name="name" placeholder="Ingresa tu nombre" required />
      </div>
      <button type="submit">🚀 Unirse al juego</button>
    </form>

    <form id="wordForm">
      <div class="form-group">
        <label for="word">Tu palabra secreta:</label>
        <input type="text" id="word" name="word" placeholder="Ingresa una palabra" required />
      </div>
      <button type="submit" class="btn-success">📝 Agregar palabra</button>
    </form>

    <div class="text-center mt-20">
      <button id="role" class="btn-warning">🔍 Consultar mi rol</button>
      <button id="status" class="btn-info">📊 Estado del juego</button>
    </div>

    <div id="gameStatus" class="game-status hidden">
      <h3>Estado del juego:</h3>
      <div id="statusContent"></div>
    </div>

    <div id="messages"></div>
  </div>

  <script src="game-client.js"></script>
  <script>
    // Custom message display for better UX
    window.showCustomMessage = function(message, type = 'info') {
      const messagesContainer = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      messageDiv.textContent = message;
      
      messagesContainer.appendChild(messageDiv);
      
      // Auto-remove after 5 seconds
      setTimeout(() => {
        if (messageDiv.parentNode) {
          messageDiv.parentNode.removeChild(messageDiv);
        }
      }, 5000);
    };

    // Additional functionality specific to player page
    gameClient.setupButton('status', async () => {
      const status = await gameClient.getGameStatus();
      const statusDiv = document.getElementById('gameStatus');
      const contentDiv = document.getElementById('statusContent');
      
      contentDiv.innerHTML = `
        <p><strong>Estado:</strong> ${status.started ? '🟢 Iniciado' : '🔴 No iniciado'}</p>
        <p><strong>Jugadores:</strong> ${status.playerCount}</p>
        <p><strong>Palabras:</strong> ${status.wordsCount}</p>
        ${status.starterPlayer ? `<p><strong>Jugador inicial:</strong> ${status.starterPlayer}</p>` : ''}
      `;
      
      statusDiv.classList.remove('hidden');
      if (status.started) {
        statusDiv.classList.add('started');
      }
    });

    // Enhanced role check with better messaging
    gameClient.handleRoleCheck = async function() {
      let name = this.playerName;
      
      if (!name) {
        name = prompt("Ingrese el nombre del jugador:");
        if (!name) return;
      }

      try {
        const playerState = await this.getPlayerState(name);
        
        if (playerState.role === 'impostor') {
          this.showMessage("🎭 ¡Eres el IMPOSTOR! Tu objetivo es pasar desapercibido.", 'warning');
        } else {
          this.showMessage(`📝 Eres un jugador normal. Tu palabra es: "${playerState.word}"`, 'success');
        }
      } catch (error) {
        if (error.message.includes('no ha comenzado')) {
          this.showMessage('⏳ La partida aún no ha comenzado. Espera a que el host la inicie.', 'info');
        } else {
          throw error;
        }
      }
    };
  </script>
</body>

</html>